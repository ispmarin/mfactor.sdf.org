<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags always come first -->
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Data Science workflow with reproducible research | Another Life Form
</title>
  <link rel="canonical" href="http://mfactor.sdf.org/blog/2015_12_08_reproducible_ds.html">

  <link rel="alternate" type="application/atom+xml" href="http://mfactor.sdf.org/blog/feeds/all.atom.xml" title="Full Atom Feed">
  <link rel="alternate" type="application/atom+xml" href="http://mfactor.sdf.org/blog/feeds/data-science.atom.xml" title="Categories Atom Feed">


  <link rel="stylesheet" href="http://mfactor.sdf.org/blog/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="http://mfactor.sdf.org/blog/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="http://mfactor.sdf.org/blog/theme/css/pygments/monokai.min.css">
  <link rel="stylesheet" href="http://mfactor.sdf.org/blog/theme/css/style.css">


<meta name="description" content="Organization of a data science workflow using CRISP-DM and Reproducible Research">
</head>

<body>
  <header class="header">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <h1 class="title"><a href="http://mfactor.sdf.org/blog">Another Life Form</a></h1>
          <p class="text-muted">Science, Data Science and Python</p>
          <ul class="list-inline">
            <li class="list-inline-item"><a href="https://br.linkedin.com/in/ispmarin/en" target="_blank">linkedin</a></li>
            <li class="list-inline-item"><a href="https://github.com/ispmarin" target="_blank">github</a></li>
            <li class="list-inline-item text-muted">|</li>
            <li class="list-inline-item"><a href="http://mfactor.sdf.org/blog/pages/about.html">About</a></li>
          </ul>
        </div>
      </div>
    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>Data Science workflow with reproducible&nbsp;research
</h1>
      <hr>
<article class="article">
  <header>
    <ul class="list-inline">
      <li class="list-inline-item text-muted" title="2015-12-08T00:00:00-02:00">
        <i class="fa fa-clock-o"></i>
        ter 08 dezembro 2015
      </li>
      <li class="list-inline-item">
        <i class="fa fa-folder-open-o"></i>
        <a href="http://mfactor.sdf.org/blog/category/data-science.html">data science</a>
      </li>
      <li class="list-inline-item">
        <i class="fa fa-user-o"></i>
        <a href="http://mfactor.sdf.org/blog/author/ivan-marin.html">Ivan Marin</a>      </li>
      <li class="list-inline-item">
        <i class="fa fa-files-o"></i>
        <a href="http://mfactor.sdf.org/blog/tag/data-science.html">#data science</a>,         <a href="http://mfactor.sdf.org/blog/tag/data.html">#data</a>      </li>
    </ul>
  </header>
  <div class="content">
    <h1>Data science&nbsp;workflow</h1>
<p>I&#8217;ve been wondering and tinkering about how to structure my data science projects, thinking on the lines of <a href="http://reproducibleresearch.net/">Reproducible Research</a> and separation of information. There is a lot of talk about the <span class="caps">CRISP</span>-<span class="caps">DM</span> <a href="https://en.wikipedia.org/wiki/Cross_Industry_Standard_Process_for_Data_Mining">Cross Industry Standard Process for Data Mining</a> and I believe that <span class="caps">CRISP</span>-<span class="caps">DM</span> is indeed a good approach. There are others like <a href="https://en.wikipedia.org/wiki/SEMMA"><span class="caps">SEMMA</span></a> that are similar. But how these processes come down to a real project organization? Breaking down the steps, in a general overview, a data science project generally&nbsp;has</p>
<ul>
<li><code>data</code>, either the datasets or samples, that will be worked&nbsp;on</li>
<li><code>src</code> (a code folder), for analysis, <span class="caps">ETL</span> and&nbsp;modeling</li>
<li><code>documentation</code> about the problem, business case, the data and the&nbsp;solution</li>
<li><code>results</code>, in form of processed data, a software deployment process or final documentation (including&nbsp;presentation)</li>
</ul>
<p>Of course your project will have other needs or either a more complex or more simple structure, also depending on how you think about <span class="caps">CRISP</span>-<span class="caps">DM</span> or your own approach. But so far this structure above has helped me to keep things organized and understandable based on <span class="caps">CRISP</span>-<span class="caps">DM</span>. I try to keep in line the ideas from both the process and reproducible&nbsp;research.</p>
<p>I also have a few other requirements for my&nbsp;projects:</p>
<ol>
<li>all code must be&nbsp;versioned</li>
<li>all data must be identified by data and&nbsp;local</li>
<li>the documentation should also be versioned a preferably&nbsp;autogenerated</li>
<li>the results should be reproducible, without&nbsp;intervention</li>
<li>libraries should be isolated from the system and preferably portable to other&nbsp;systems</li>
</ol>
<p>Requirements 1 and 3 are satisfied using <code>git</code>. I usually set the root of the project as the <code>git</code> base directory and exclude on the <code>.gitignore</code> the data and results directories. I decided not to include the <code>results</code> folder because of requirement 4 and also because they can be big. An exception can be made if there are presentations inside <code>results</code> that are not autogenerated. Part of the autogeneration of the documentation is made writing it on the analysis code itself, a la <code>jupyter</code> notebook&nbsp;style.</p>
<p>Requirement 2 is satisfied using a simple directory structure. Inside the <code>data</code> folder I create a directory with the date as the name, like <code>20151207</code> and include hour and minute if I&#8217;m generating samples with this precision. If I need to generate a sample a <code>sample</code> directory inside the dated directory suffices. Some people advise to save intermediate steps if there are a lot of data cleanup steps. I tend to do it if the cleanup step is too time consuming, otherwise I just recompute the cleanup step. I also tend to include the metadata with the data, outside the data file, with the same name as the data file but with a <code>.meta</code> termination.</p>
<p>The local part of the <code>data</code> can be tricky when using a database as a source, for example. This is one of the points where reproducible research helps a bit: databases can change, so let&#8217;s say you run today a model with data pulled from a database. You should be able to reproduce exactly the same results any time, but the database could have been updated in the meantime and your project is not reproducible anymore. I download the data to a local storage file (either csv or <span class="caps">HDF5</span> or other format at hand) and use this file to do my computations. There is a real problem if the data set is too large or the data is sensitive, but so far I&#8217;ve managed to do it without serious&nbsp;issues.</p>
<p>I usually use <code>jupyter</code> and <code>python</code> to do my analysis and modeling, so to satisfy requirement 4 I tend to write my notebooks and code so they are idempotent and can be restarted from different points. That also means that the results would be overwritten everytime the code is run. This can be a problem if a experiment is being done with different inputs, so this should be taken into account when thinking on the structure of the <code>results</code> folder (It can use the same dated approach from the <code>data</code> directory).</p>
<p>The last requirement depends on the language or languages that are being used in the project. This is a rather lengthy subject, so I will restrict myself to Python. I use <code>virtualenvs</code> without site packages and keep them on the <code>src</code> folder. Each project has its own virtualenv. Other requirements, like map data, is also included on the project structure, so the entire project folder can be moved without great impact. Virtualenvs are not that portable between systems and this has been a problem so far without solution, especially if the other system doesn&#8217;t have internet&nbsp;access.</p>
<h2>Project&nbsp;Example</h2>
<p>As an example I have the <code>polls</code> project, with the following directory&nbsp;structure:</p>
<div class="highlight"><pre><span></span><span class="na">.pools</span>
<span class="err">+--</span> <span class="nf">data</span>
   <span class="err">+--</span> <span class="err">20151206</span>
      <span class="err">+--</span> <span class="nf">polls.csv</span>
      <span class="err">+--</span> <span class="nf">polls.meta</span>
      <span class="err">+--</span> <span class="nf">sample</span>
         <span class="err">+--</span> <span class="nf">polls_sample_1000.csv</span>
         <span class="err">+--</span> <span class="nf">polls_sample_200.csv</span>
   <span class="err">+--</span> <span class="err">20151203</span>
      <span class="err">+--</span> <span class="nf">polls_rs.csv</span>
      <span class="err">+--</span> <span class="nf">sample</span>
         <span class="err">+--</span> <span class="nf">polls_sample_rs_1000.csv</span>
         <span class="err">+--</span> <span class="nf">polls_sample_pe_200.csv</span>
   <span class="err">+--</span> <span class="err">20151202</span>
      <span class="err">+--</span> <span class="nf">all_polls.hdf</span>
      <span class="err">+--</span> <span class="nf">all_polls.meta</span>
<span class="err">+--</span> <span class="nf">src</span>
   <span class="err">+--</span> <span class="nf">analysis</span>
      <span class="err">+--</span> <span class="nf">pools.ipynb</span>
   <span class="err">+--</span> <span class="nf">sampling</span>
      <span class="err">+--</span> <span class="nf">sampling.py</span>
   <span class="err">+--</span> <span class="nf">etl</span>
      <span class="err">+--</span> <span class="nf">extract_from_mongo.py</span>
   <span class="err">+--</span> <span class="nf">generate_results</span>
      <span class="err">+--</span> <span class="nf">do_models.py</span>
      <span class="err">+--</span> <span class="nf">generate_webpage.py</span>
      <span class="err">+--</span> <span class="nf">generate_approach_action.py</span>
         <span class="err">+--</span> <span class="nf">images</span>
            <span class="err">+--</span> <span class="nf">header.png</span>
            <span class="err">+--</span> <span class="nf">logo.svg</span>
<span class="err">+--</span> <span class="nf">doc</span>
   <span class="err">+--</span> <span class="nf">business</span>
      <span class="err">+--</span> <span class="nf">use_case.md</span>
   <span class="err">+--</span> <span class="nf">algorithm</span>
      <span class="err">+--</span> <span class="nf">machine_learning.md</span>
      <span class="err">+--</span> <span class="nf">analysis_results.md</span>
         <span class="err">+--</span> <span class="nf">images</span>
            <span class="err">+--</span> <span class="nf">analysis_all.png</span>
<span class="err">+--</span> <span class="nf">results</span>
   <span class="err">+--</span> <span class="err">20151207</span>
      <span class="err">+--</span> <span class="nf">voters.csv</span>
      <span class="err">+--</span> <span class="nf">control_group.csv</span>
      <span class="err">+--</span> <span class="nf">approach_and_action.md</span>
</pre></div>


<p>One of the things that I also consider is the use of symbolic links from the <code>src</code> folder to the <code>results</code> folder or do a copy of a figure, from&nbsp;example.</p>
<p>On the next article I plan to show a pattern for <code>jupyter</code> notebooks to handle this&nbsp;structure.</p>
  </div>
</article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="row">
       <ul class="col-sm-6 list-inline">
          <li class="list-inline-item"><a href="http://mfactor.sdf.org/blog/authors.html">Authors</a></li>
          <li class="list-inline-item"><a href="http://mfactor.sdf.org/blog/archives.html">Archives</a></li>
          <li class="list-inline-item"><a href="http://mfactor.sdf.org/blog/categories.html">Categories</a></li>
          <li class="list-inline-item"><a href="http://mfactor.sdf.org/blog/tags.html">Tags</a></li>
        </ul>
        <p class="col-sm-6 text-sm-right text-muted">
          Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a> / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
        </p>
      </div>
    </div>
  </footer>
</body>

</html>
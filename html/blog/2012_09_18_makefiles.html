<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags always come first -->
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Fiddling with Makefiles, for the last time | Another Life Form
</title>
  <link rel="canonical" href="http://mfactor.sdf.org/blog/2012_09_18_makefiles.html">

  <link rel="alternate" type="application/atom+xml" href="http://mfactor.sdf.org/blog/feeds/all.atom.xml" title="Full Atom Feed">
  <link rel="alternate" type="application/atom+xml" href="http://mfactor.sdf.org/blog/feeds/tools.atom.xml" title="Categories Atom Feed">


  <link rel="stylesheet" href="http://mfactor.sdf.org/blog/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="http://mfactor.sdf.org/blog/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="http://mfactor.sdf.org/blog/theme/css/pygments/monokai.min.css">
  <link rel="stylesheet" href="http://mfactor.sdf.org/blog/theme/css/style.css">


<meta name="description" content="I was struggling with writing another makefile in my life, but it seems that if you want to automate some tasks in vim, you have to write one. I’ll also use several compilers to check interoperability of the new code that I’ll be working, so creating a makefile …">
</head>

<body>
  <header class="header">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <h1 class="title"><a href="http://mfactor.sdf.org/blog">Another Life Form</a></h1>
          <p class="text-muted">Science, Data Science and Python</p>
          <ul class="list-inline">
            <li class="list-inline-item"><a href="https://br.linkedin.com/in/ispmarin/en" target="_blank">linkedin</a></li>
            <li class="list-inline-item"><a href="https://github.com/ispmarin" target="_blank">github</a></li>
          </ul>
        </div>
      </div>
    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>Fiddling with Makefiles, for the last&nbsp;time
</h1>
      <hr>
<article class="article">
  <header>
    <ul class="list-inline">
      <li class="list-inline-item text-muted" title="2012-09-18T16:11:00-03:00">
        <i class="fa fa-clock-o"></i>
        ter 18 setembro 2012
      </li>
      <li class="list-inline-item">
        <i class="fa fa-folder-open-o"></i>
        <a href="http://mfactor.sdf.org/blog/category/tools.html">tools</a>
      </li>
      <li class="list-inline-item">
        <i class="fa fa-user-o"></i>
        <a href="http://mfactor.sdf.org/blog/author/ivan-marin.html">Ivan Marin</a>      </li>
      <li class="list-inline-item">
        <i class="fa fa-files-o"></i>
        <a href="http://mfactor.sdf.org/blog/tag/compilation.html">#compilation</a>,         <a href="http://mfactor.sdf.org/blog/tag/computational-physics.html">#computational physics</a>,         <a href="http://mfactor.sdf.org/blog/tag/science.html">#science</a>      </li>
    </ul>
  </header>
  <div class="content">
    <p>I was struggling with writing another makefile in my life, but it seems
that if you want to automate some tasks in vim, you have to write one.
I&#8217;ll also use several compilers to check interoperability of the new
code that I&#8217;ll be working, so creating a makefile, even if just for one
file, is worthwhile. But of course I never properly learned how to write
one by myself, so here is my post. First, automatic variables, directly
from the
<a class="reference external" href="http://www.gnu.org/software/make/manual/make.html#Automatic-Variables">manual</a>:</p>
<p><tt class="docutils literal">$&#64;</tt>The file name of the target of the rule. If the target is an
archive member, then ‘$&#64;’ is the name of the archive file. In a pattern
rule that has multiple targets (see&nbsp;<a class="reference external" href="http://www.gnu.org/software/make/manual/make.html#Pattern-Intro">Introduction to Pattern
Rules</a>),
‘$&#64;’ is the name of whichever target caused the rule&#8217;s recipe to be&nbsp;run.</p>
<p><tt class="docutils literal">$%</tt>The target member name, when the target is an archive member.
See&nbsp;<a class="reference external" href="http://www.gnu.org/software/make/manual/make.html#Archives">Archives</a>.
For example, if the target is&nbsp;foo.a(bar.o)&nbsp;then ‘$%’ is&nbsp;bar.o&nbsp;and ‘$&#64;’
is&nbsp;foo.a. ‘$%’ is empty when the target is not an archive&nbsp;member.</p>
<p><tt class="docutils literal">$&lt;</tt>The name of the first prerequisite. If the target got its recipe
from an implicit rule, this will be the first prerequisite added by the
implicit rule (see&nbsp;<a class="reference external" href="http://www.gnu.org/software/make/manual/make.html#Implicit-Rules">Implicit
Rules</a>).</p>
<div class="line-block">
<div class="line"><tt class="docutils literal">$?</tt>The names of all the prerequisites that are newer than the
target, with spaces between them. For prerequisites which are archive
members, only the named member is used
(see&nbsp;<a class="reference external" href="http://www.gnu.org/software/make/manual/make.html#Archives">Archives</a>).</div>
<div class="line-block">
<div class="line"><tt class="docutils literal">$^</tt>The names of all the prerequisites, with spaces between them.
For prerequisites which are archive members, only the named member is
used
(see&nbsp;<a class="reference external" href="http://www.gnu.org/software/make/manual/make.html#Archives">Archives</a>).
A target has only one prerequisite on each other file it depends on,
no matter how many times each file is listed as a prerequisite. So if
you list a prerequisite more than once for a target, the value
of&nbsp;<tt class="docutils literal">$^</tt>&nbsp;contains just one copy of the name. This list
does&nbsp;<strong>not</strong>&nbsp;contain any of the order-only prerequisites; for those
see the ‘$|’ variable, below.</div>
<div class="line"><tt class="docutils literal">$+</tt>This is like ‘$^’, but prerequisites listed more than once
are duplicated in the order they were listed in the makefile. This is
primarily useful for use in linking commands where it is meaningful to
repeat library file names in a particular order.</div>
</div>
</div>
<p><tt class="docutils literal">$|</tt>The names of all the order-only prerequisites, with spaces
between&nbsp;them.</p>
<p><tt class="docutils literal">$*</tt>The stem with which an implicit rule matches (see&nbsp;<a class="reference external" href="http://www.gnu.org/software/make/manual/make.html#Pattern-Match">How Patterns
Match</a>).
If the target is&nbsp;dir/a.foo.b&nbsp;and the target pattern is&nbsp;a.%.b&nbsp;then the
stem is&nbsp;dir/foo. The stem is useful for constructing names of related
files.&nbsp;In a static pattern rule, the stem is part of the file name that
matched the ‘%’ in the target&nbsp;pattern.</p>
<p>So the most used ones in the makefiles that I&#8217;ve seen are $&#64;, $&gt; and $^.
So, $&#64; means the name of the compilation rule, $^ means the source
files. For&nbsp;example,</p>
<pre class="literal-block">
FC = gfortran
FCFLAGS = -g -fbounds-check
FCFLAGS = -O2
IFC = ifort
IFCFLAGS = -g
#FCFLAGS += -I/usr/include
#LDFLAGS =
SRC = bio-f.f
bio-gfortran: $(SRC)
 $(FC) $(FCFLAGS) -o $&#64; $^ $(LDFLAGS)
bio-ifort: $(SRC)
 $(IFC) $(IFCFLAGS) -o $&#64; $^ $(IFCFLAGS)
gf: bio-gfortran
ifort: bio-ifort
# Utility targets
.PHONY: clean veryclean
clean:
 rm -f *.o *.mod *.MOD
</pre>
<p>What I&#8217;m doing basically is to tell to compile in this fashion: for the
rule bionapl-gfortran, $&#64; means this name and $^ means the source files.
So this&nbsp;line,</p>
<p>$(<span class="caps">FC</span>) $(<span class="caps">FCFLAGS</span>) -o $&#64; $^ $(<span class="caps">LDFLAGS</span>)</p>
<p>is use the compiler defined by <span class="caps">FC</span> with the compiler flags <span class="caps">FCFLAGS</span> using
the output name (-o $&#64;) bio-gfortran and the source file ($^) that <span class="caps">SRC</span>
tells you to use. The line below is the same&nbsp;thing.</p>
<p>Note the line gf: bio-gfortran and the one below. This is just a
convenient renaming: instead of&nbsp;calling</p>
<p>make&nbsp;bio-gfortran</p>
<p>I can call and&nbsp;etc.</p>
<p>make&nbsp;gf</p>
<p>The meaning for the $&#64; and $^ can be a little more complicated with
build dependencies, but this is enough for now. I&#8217;m sure the programmers
on standby will provide better options and how to save changing the name
for each compilation, etc. Feel free to&nbsp;contribute!</p>

  </div>
</article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="row">
       <ul class="col-sm-6 list-inline">
          <li class="list-inline-item"><a href="http://mfactor.sdf.org/blog/authors.html">Authors</a></li>
          <li class="list-inline-item"><a href="http://mfactor.sdf.org/blog/archives.html">Archives</a></li>
          <li class="list-inline-item"><a href="http://mfactor.sdf.org/blog/categories.html">Categories</a></li>
          <li class="list-inline-item"><a href="http://mfactor.sdf.org/blog/tags.html">Tags</a></li>
        </ul>
        <p class="col-sm-6 text-sm-right text-muted">
          Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a> / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
        </p>
      </div>
    </div>
  </footer>
</body>

</html>